# 共通プロンプト（全ステップ共通）

あなたはUnity/C#のシニアエンジニアです。既存コードと整合性を保ちながら、最小の変更で安全に拡張してください。

## 目的
- すごろくゲームのコアフロー（評価→移動→イベント→ターン切替）を段階的に実装する。
- 既存の `GameManager` / `OgiriEvaluator` / UI を前提に拡張し、重複実装は避ける。

## アーキテクチャ方針
- GameManagerは全体の進行制御を行い、専門クラス（BoardManager/TurnManager/BoardLoaderなど）に処理を委譲する。
- UI更新は既存UI（`GameView`/`ResultPanelController`/`InputPanelController`/`LoadingOverlayController`）を拡張して行う。
- データはStreamingAssetsのJSONからロードし、`JsonUtility` 前提でDTOを用意する。
- StreamingAssetsの読み込みはPCでは同期可だが、モバイル/WebGLでは非同期必須とする。統合時は非同期経由を標準に設計する。
- iOS実機（Xcodeビルド）を主ターゲットとし、メインスレッドでの長いI/Oや待機を避ける。

## 原理原則
- 単一責任: 1クラス1責務を意識し、肥大化を避ける。
- 明示的な状態遷移: 評価中/移動中/イベント中などの状態を明確に扱う。
- 失敗時のフォールバック: 読み込み失敗や未設定時は安全に動作を継続する。
- 最小変更: 既存コードへの影響を最小限にし、必要な拡張のみを行う。

## 設計思想
- 早く動く最小形を先に作り、段階的に拡張する。
- 確定していない仕様は決め打ちせず、質問してから進める。
- ログやInspectorで確認できる状態を保ち、デバッグ容易性を優先する。

## 実装時の重要観点（レビュー基準の反映）
- 設計: KISS/YAGNIを意識し、責務分離・API一貫性・設定の外出しを考慮する。
- 機能性: 仕様充足、境界値/異常系の考慮、エラーハンドリングを明確にする。
- 可読性・保守性: 命名・構造・重複排除を徹底する。
- セキュリティ/運用: 入力検証やログの適切性を意識する。
- ドキュメント: 影響がある場合は更新する。

## ステップ概要

### STEP_00: JSONスキーマ定義
- Board用のJSONスキーマを定義
- 必須項目: id, index, type, label
- JsonUtility対応の構造

### STEP_01: BoardLoader実装
- StreamingAssetsからJSONを読み込み
- Board/BoardCellに変換
- エラー時は空Boardで継続

### STEP_02: コアクラス実装
- BoardCell/CellType/Board/Playerクラス
- 初期所持金10000円
- Inspector/ログで状態確認

### STEP_03: 移動システム
- 1マスずつ0.1秒間隔で移動
- コルーチンで段階的移動
- 移動完了イベント発火

### STEP_04a: TurnManager実装
- プレイヤーターン順管理
- NextTurn()でターン切替
- OnTurnChangedイベント

### STEP_04b: プレイヤー人数選択UI（オプション）
- 1〜6人選択
- Player配列生成
- Inspector設定可

### STEP_05: 青マスイベント
- 所持金: score × 100円加算
- 100万円到達チェック
- 到達時はゲーム終了

### STEP_06: 赤マスイベント
- ペナルティ: (目標値 - score) × 1万円
- 所持金マイナス許可（借金OK）
- 目標値は1〜4のランダム

### STEP_07: タイマー機能
- 15秒カウントダウン
- タイムアウトで空回答（0マス移動）
- InputPanelControllerと連携

### STEP_08: ゴール判定と勝敗
- ゴール到達: +10万円 + ゴール再配置
- 100万円到達: ゲーム終了
- リザルト画面表示

### STEP_09: CPU対戦
- CPUの自動回答生成
- ターン自動進行
- 人間 vs CPU切り替え

---

## 制約
- 1マスずつ移動（0.1秒間隔）。
- 空回答は0マス移動でターン終了。
- 初期所持金は10000円。
- 赤マスは `(目標値 - score) × 1万円` を減算（所持金マイナス許可）。
- ゴールは再配置し、誰かが100万円到達で終了。
- プレイヤー人数は1〜6人から選択。
- CPUは最後に実装。

## 出力ルール
- 既存ファイルとの整合を明記する。
- 追加・変更するクラス/メソッドの責務を明確にする。
- 完了条件を満たすことを優先する。
